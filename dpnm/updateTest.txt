var opts, serverInfo;

var cursor = Tasks.find({});
cursor.forEach(function (info) {
/**      console.log(info)
  console.log("info ^^")
  console.log(info.ip)
  console.log(info.port) */
  opts = { range: [String(info.ip)], ports: String(parseInt(info.port) + 1) }
//      console.log(opts)
//      console.log("opts is above this")

  libnmap.nmap('scan', opts, Meteor.bindEnvironment(function(err, report){
    if (err) throw err
    report.forEach(function(item) {
    serverInfo = (item[0])
//        console.log(info.status)
//        console.log(info.service)

    Tasks.update({ip: info.ip}, {
      $set:
      {
        port: serverInfo.ports[0].port,
        status: serverInfo.ports[0].state,
        service: serverInfo.ports[0].service
      }
    });
  });
}));
});

141.223.82.74
110






updateServers as a method

updateServers: function () {
  if (! Meteor.user()) {
    throw new Meteor.Error("not-authorized");
  }

  var opts, serverInfo;
  console.log("middle of updateServers");
  var cursor = Tasks.find({});
  cursor.forEach(function (info) {
/**      console.log(info)
    console.log("info ^^")
    console.log(info.ip)
    console.log(info.port) */
    opts = { range: [String(info.ip)], ports: String(info.port) }
//      console.log(opts)
//      console.log("opts is above this")

    libnmap.nmap('scan', opts, Meteor.bindEnvironment(function(err, report){
      if (err) throw err
      report.forEach(function(item) {
      serverInfo = (item[0])
//        console.log(info.status)
//        console.log(info.service)

      Tasks.update({ip: info.ip, port: info.port}, {
        $set:
        {
          status: serverInfo.ports[0].state,
          service: serverInfo.ports[0].service
        }
      });
    });

    if (serverInfo.ports[0].state == "closed") {  // If server is down, send mail
    Email.send({to: 'josephl@live.ca',      // Can change email to anything
                from: 'throwaway42794@gmail.com',
                subject: info.ip + " has gone down (port:  " + info.port + ").",
                text: "Read subject!"
    });
  }

  }));
});

},
